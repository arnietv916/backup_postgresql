PostgreSQL Backup Script (Bash)

Скрипт делает резервные копии PostgreSQL по алгоритму:
1) определяет список баз данных  
2) для каждой базы делает дамп штатным `pg_dump`  
3) сжимает дамп в gzip  
4) проверяет целостность `gzip -t`  
5) переносит только исправные архивы в `/backup/pg` (предполагается отдельный диск)

Особенности:
- лаконичное логирование всех шагов
- корректная обработка ошибок (если шаг упал — следующие шаги для этой БД не выполняются)
- никаких временных файлов после завершения (даже при ошибках)
- в `/backup/pg` остаются только исправные `.gz`

Требования

- Bash
- `psql`, `pg_dump` (PostgreSQL client tools)
- `gzip`, `df`, `mktemp`

Установка 

```bash```
chmod +x backup_postgres.sh

Дефолтные переменные в текущей версии скрипта:

BACKUP_DIR = `/backup/pg`

LOG_FILE = `/var/log/db_backup.log (если нет прав — скрипт автоматически пишет в ./db_backup.log)`

PGHOST = `localhost`

PGPORT = `5432`

PGUSER = `backup_user`

Запуск 

```bash```
./backup_postgres.sh
echo "exit_code=$?"

Коды возврата:

0 — всё успешно
1 — часть баз упала (скрипт отработал корректно, но были ошибки по некоторым БД)
2 — критическая ошибка (нет утилит, недоступен каталог бэкапов, нет прав и т.п.)
3 — мало места (временные файлы или диск бэкапов)
4 — не получен список баз (обычно проблема доступа, пароля)

